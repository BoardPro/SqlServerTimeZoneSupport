{"name":"Sqlservertimezonesupport","tagline":"IANA Time Zone Support for Microsoft SQL Server","body":"# SQL Server Time Zone Support\r\n\r\nThis project adds full support for time zones to Microsoft SQL Server.\r\n\r\nThis implementation uses the industry standard [IANA time zone database][1].  If you are used to Microsoft Windows time zones, such as used with .NET `TimeZoneInfo`, consider using IANA time zones by using the [Noda Time][2] library.\r\n\r\nYou can read more about the IANA time zone database on [Wikipedia][3], and on [StackOverflow][4].\r\n\r\n[A list of supported time zones can be found here.][12]\r\n\r\n**Note:** This is an un-official, personal project. It is not developed or supported by Microsoft.\r\n\r\n### Installation\r\n\r\n1. Download the latest `sqltz.zip` file from [the releases page][5].\r\n2. Extract the zip file to a directory.\r\n3. Open the `tzdb.sql` file, and run it against your database.\r\n   - It will create all objects in an independent schema called `[Tzdb]`.\r\n   - Microsoft SQL Server 2008 R2 and higher are supported, including Azure SQL Database.\r\n4. Edit the `SqlTzLoader.exe.config` file in a notepad, or any text editor.\r\n   - Modify the connection string to point at your server and database, supplying any necessary authentication information.\r\n5. Run the `SqlTzLoader.exe` utility.\r\n   - It will download the latest time zone data and populate the tables in the database.\r\n\r\n### Staying Current\r\n\r\nYou can re-execute the `SqlTzLoader.exe` utility any time.  If new time zone data is available, it will download it and update the tables.  You can easily run this from SQL Agent, Windows Scheduler, or Azure Scheduler.  Please do not run it more than once daily.\r\n\r\nOur data comes from the [Noda Time TZDB NZD files][6], which in turn is generated directly from IANA releases.  Therefore, you may notice a short delay between publishing of IANA TZDB and the updated NZD file being made available.\r\n\r\n### Usage\r\n\r\nThere are several user-defined functions exposed for common time zone conversion operations.  If you need additional functions, please create an issue in [the issue tracker][7].\r\n\r\n#### UtcToLocal\r\n\r\nConverts a `datetime` or `datetime2` value from UTC to a specific time zone.  The output is a `datetimeoffset` value that has the correct local time and offset for the time zone requested.\r\n\r\n```sql\r\n-- SYNTAX\r\nTzdb.UtcToLocal([utc_datetime], [dest_timezone])\r\n\r\n-- EXAMPLE\r\nSELECT Tzdb.UtcToLocal('2015-07-01 00:00:00', 'America/Los_Angeles')\r\n-- output: '2015-06-30 17:00:00 -07:00'\r\n```\r\n\r\n#### LocalToUtc\r\n\r\nConverts a `datetime` or `datetime2` value from a specific time zone to UTC.  The output is a `datetimeoffset` value that has the correct UTC time and an offset of `+00:00`.\r\n\r\nBe aware that local-to-utc conversion is potentially a lossy operation.  For more details, consult [the dst tag wiki on StackOverflow][8].\r\n\r\n```sql\r\n-- SYNTAX\r\nTzdb.LocalToUtc([source_datetime], [source_timezone], [SkipOnSpringForwardGap], [FirstOnFallBackOverlap])\r\n\r\n-- EXAMPLE\r\nSELECT Tzdb.LocalToUtc('2015-07-01 00:00:00', 'America/Los_Angeles', 1, 1)\r\n-- output: '2015-07-01 07:00:00 +00:00'\r\n```\r\n\r\n- The `SkipOnSpringForwardGap` parameter has the following options:\r\n  - `1` : If a local time is in a DST gap due to the \"spring-forward\" DST transition, it is assumed that the clock *should* have sprung forward but didn't.  It therefore advances the time by the DST bias (usually 1 hour) so it can return a valid UTC time.  This is the default option.\r\n  - `0` : If a local time is in a DST gap due to the \"spring-forward\" DST transition, the function returns `NULL`.\r\n\r\n- The `FirstOnFallBackOverlap` parameter has the following options:\r\n  - `1` : If a local time is ambiguous due to the \"fall-back\" DST transition, the *first* occurrence is assumed.  This will always be the *daylight* time instance.  This is the default option.\r\n  - `0` : If a local time is ambiguous due to the \"fall-back\" DST transition, the *second* occurrence is assumed.  This will always be the *standard* time instance.\r\n\r\n\r\n#### ConvertZone\r\n\r\nConverts a `datetime` or `datetime2` value from a specific time zone to another specific time zone.  The output is a `datetimeoffset` value that has the correct local time and offset for the destination time zone requested.\r\n\r\nThe DST option flags are the same as the `LocalToUtc` function, and apply to the *source* time zone only.\r\n\r\n```sql\r\n-- SYNTAX\r\nTzdb.ConvertZone([source_datetime], [source_timezone], [dest_timezone], [SkipOnSpringForwardGap], [FirstOnFallBackOverlap])\r\n\r\n-- EXAMPLE\r\nSELECT Tzdb.ConvertZone('2015-07-01 00:00:00', 'America/Los_Angeles', 'Australia/Sydney', 1, 1)\r\n-- output: '2015-07-01 17:00:00 +10:00'\r\n```\r\n\r\n#### SwitchZone\r\n\r\nConverts a `datetimeoffset` value to a specific time zone.  The output is a `datetimeoffset` value that has the correct local time and offset for the time zone requested.\r\n\r\nThis function is similar to SQL Server's `SWITCHOFFSET` function, however it accepts a time zone instead of an offset - so it can take daylight saving time into account.\r\n\r\n```sql\r\n-- SYNTAX\r\nTzdb.SwitchZone([source_datetimeoffset], [dest_timezone])\r\n\r\n-- EXAMPLE\r\nSELECT Tzdb.SwitchZone('2015-07-01 00:00:00 -04:00', 'Asia/Kolkata')\r\n-- output: '2015-07-01 09:30:00 +05:30'\r\n```\r\n\r\n#### GetZoneAbbreviation\r\n\r\nDetermines the correct abbreviation to use for the `datetimeoffset` value and time zone provided.  The output is a `varchar(10)` containing the abbreviation requested.\r\n\r\nIf you don't have a `datetimeoffset`, you should first obtain one either by using the `LocalToUtc` or `UtcToLocal` conversion functions, or by crafting it manually with SQL Server's `TODATETIMEOFFSET` function.  Do not pass a `datetime` or `datetime2` in, or the *server's* local time zone will get applied during the conversion.\r\n\r\nNote that the abbreviations for many time zones depend on the specific date and time that they apply to.\r\n\r\n```sql\r\n-- SYNTAX\r\nTzdb.GetZoneAbbreviation([datetimeoffset], [timezone])\r\n\r\n-- EXAMPLE\r\nSELECT Tzdb.GetZoneAbbreviation('2015-07-01 00:00:00 -04:00', 'America/New_York')\r\n-- output: 'EDT'\r\n```\r\n\r\n### Shameless Plug\r\n\r\nIf you want to learn more about time zones, and all of the lovely bits of programming that go around them, please consider watching my Pluralsight course, [Date and Time Fundamentals][9].\r\n\r\nI also have a blog at [CodeOfMatt.com][10], which covers several issues surrounding dates, times, and time zones.\r\n\r\nThanks!\r\n\r\n### License\r\n\r\nThis project is made freely available under [the MIT license][11].  Attribution is requested.\r\n\r\nThis project uses the following external resources:\r\n\r\n- [Noda Time][2] (Apache licensed)\r\n- [IANA Time Zone Database][1] (public domain)\r\n\r\n[1]: http://www.iana.org/time-zones\r\n[2]: http://nodatime.org\r\n[3]: http://en.wikipedia.org/wiki/Tz_database\r\n[4]: http://stackoverflow.com/tags/timezone/info\r\n[5]: https://github.com/mj1856/SqlServerTimeZoneSupport/releases\r\n[6]: http://nodatime.org/tzdb/\r\n[7]: https://github.com/mj1856/SqlServerTimeZoneSupport/issues\r\n[8]: http://stackoverflow.com/tags/dst/info\r\n[9]: http://www.pluralsight.com/courses/date-time-fundamentals\r\n[10]: http://codeofmatt.com\r\n[11]: https://github.com/mj1856/SqlServerTimeZoneSupport/blob/master/LICENSE\r\n[12]: http://en.wikipedia.org/wiki/List_of_tz_database_time_zones\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}